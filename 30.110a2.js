(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{476:function(t,e,n){"use strict";n.d(e,"a",function(){return u});var o,r=n(1),i=n.n(r),a=n(904),s=n.n(a),c=(n(470),o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),p=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},l=s.a.Item;var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.render=function(){return i.a.createElement(l,p({},(t=this.props.valid,e=this.props.messageOnInvalid,n=this.props.messageOnSuccess,{validateStatus:t?"success":"error",help:t?n:e})),this.props.children);var t,e,n},e}(i.a.Component)},478:function(t,e,n){"use strict";n.r(e);var o=n(4),r=n.n(o),i=n(47),a=n.n(i),s=n(8),c=n.n(s),p=n(7),l=n.n(p),u=n(9),f=n.n(u),d=n(1),h=n.n(d),y=function(t){return function(t){function e(){return c()(this,e),l()(this,t.apply(this,arguments))}return f()(e,t),e.prototype.componentDidUpdate=function(){if(this.path){var t=this.path.style;t.transitionDuration=".3s, .3s, .3s, .06s";var e=Date.now();this.prevTimeStamp&&e-this.prevTimeStamp<100&&(t.transitionDuration="0s, 0s"),this.prevTimeStamp=Date.now()}},e.prototype.render=function(){return t.prototype.render.call(this)},e}(t)},g=n(0),m=n.n(g),b={className:"",percent:0,prefixCls:"rc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,style:{},trailColor:"#D9D9D9",trailWidth:1},v={className:m.a.string,percent:m.a.oneOfType([m.a.number,m.a.string]),prefixCls:m.a.string,strokeColor:m.a.string,strokeLinecap:m.a.oneOf(["butt","round","square"]),strokeWidth:m.a.oneOfType([m.a.number,m.a.string]),style:m.a.object,trailColor:m.a.string,trailWidth:m.a.oneOfType([m.a.number,m.a.string])},w=function(t){function e(){return c()(this,e),l()(this,t.apply(this,arguments))}return f()(e,t),e.prototype.render=function(){var t=this,e=this.props,n=e.className,o=e.percent,i=e.prefixCls,s=e.strokeColor,c=e.strokeLinecap,p=e.strokeWidth,l=e.style,u=e.trailColor,f=e.trailWidth,d=a()(e,["className","percent","prefixCls","strokeColor","strokeLinecap","strokeWidth","style","trailColor","trailWidth"]);delete d.gapPosition;var y={strokeDasharray:"100px, 100px",strokeDashoffset:100-o+"px",transition:"stroke-dashoffset 0.3s ease 0s, stroke 0.3s linear"},g=p/2,m="M "+("round"===c?g:0)+","+g+"\n           L "+("round"===c?100-p/2:100)+","+g,b="0 0 100 "+p;return h.a.createElement("svg",r()({className:i+"-line "+n,viewBox:b,preserveAspectRatio:"none",style:l},d),h.a.createElement("path",{className:i+"-line-trail",d:m,strokeLinecap:c,stroke:u,strokeWidth:f||p,fillOpacity:"0"}),h.a.createElement("path",{className:i+"-line-path",d:m,strokeLinecap:c,stroke:s,strokeWidth:p,fillOpacity:"0",ref:function(e){t.path=e},style:y}))},e}(d.Component);w.propTypes=v,w.defaultProps=b;var O=y(w),j=function(t){function e(){return c()(this,e),l()(this,t.apply(this,arguments))}return f()(e,t),e.prototype.getPathStyles=function(){var t=this.props,e=t.percent,n=t.strokeWidth,o=t.gapDegree,r=void 0===o?0:o,i=50-n/2,a=0,s=-i,c=0,p=-2*i;switch(t.gapPosition){case"left":a=-i,s=0,c=2*i,p=0;break;case"right":a=i,s=0,c=-2*i,p=0;break;case"bottom":s=i,p=2*i}var l="M 50,50 m "+a+","+s+"\n     a "+i+","+i+" 0 1 1 "+c+","+-p+"\n     a "+i+","+i+" 0 1 1 "+-c+","+p,u=2*Math.PI*i;return{pathString:l,trailPathStyle:{strokeDasharray:u-r+"px "+u+"px",strokeDashoffset:"-"+r/2+"px",transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s"},strokePathStyle:{strokeDasharray:e/100*(u-r)+"px "+u+"px",strokeDashoffset:"-"+r/2+"px",transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s"}}},e.prototype.render=function(){var t=this,e=this.props,n=e.prefixCls,o=e.strokeWidth,i=e.trailWidth,s=e.strokeColor,c=(e.percent,e.trailColor),p=e.strokeLinecap,l=e.style,u=e.className,f=a()(e,["prefixCls","strokeWidth","trailWidth","strokeColor","percent","trailColor","strokeLinecap","style","className"]),d=this.getPathStyles(),y=d.pathString,g=d.trailPathStyle,m=d.strokePathStyle;return delete f.percent,delete f.gapDegree,delete f.gapPosition,h.a.createElement("svg",r()({className:n+"-circle "+u,viewBox:"0 0 100 100",style:l},f),h.a.createElement("path",{className:n+"-circle-trail",d:y,stroke:c,strokeWidth:i||o,fillOpacity:"0",style:g}),h.a.createElement("path",{className:n+"-circle-path",d:y,strokeLinecap:p,stroke:s,strokeWidth:0===this.props.percent?0:o,fillOpacity:"0",ref:function(e){t.path=e},style:m}))},e}(d.Component);j.propTypes=r()({},v,{gapPosition:m.a.oneOf(["top","bottom","left","right"])}),j.defaultProps=r()({},b,{gapPosition:"top"});var _=y(j);n.d(e,"Line",function(){return O}),n.d(e,"Circle",function(){return _});e.default={Line:O,Circle:_}},479:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=h(n(4)),r=h(n(38)),i=h(n(8)),a=h(n(15)),s=h(n(7)),c=h(n(9)),p=h(n(0)),l=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(1)),u=h(n(35)),f=n(478),d=h(n(21));function h(t){return t&&t.__esModule?t:{default:t}}var y=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&(n[o[r]]=t[o[r]])}return n},g={normal:"#108ee9",exception:"#ff5500",success:"#87d068"},m=function(t){return!t||t<0?0:t>100?100:t},b=function(t){function e(){return(0,i.default)(this,e),(0,s.default)(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return(0,c.default)(e,t),(0,a.default)(e,[{key:"render",value:function(){var t,e=this.props,n=e.prefixCls,i=e.className,a=e.percent,s=void 0===a?0:a,c=e.status,p=e.format,h=e.trailColor,b=e.size,v=e.successPercent,w=e.type,O=e.strokeWidth,j=e.width,_=e.showInfo,C=e.gapDegree,P=void 0===C?0:C,x=e.gapPosition,k=y(e,["prefixCls","className","percent","status","format","trailColor","size","successPercent","type","strokeWidth","width","showInfo","gapDegree","gapPosition"]),E=parseInt(v?v.toString():s.toString(),10)>=100&&!("status"in e)?"success":c||"normal",T=void 0,D=void 0,S=p||function(t){return t+"%"};if(_){var R=void 0,I="circle"===w||"dashboard"===w?"":"-circle";R="exception"===E?p?S(m(s)):l.createElement(u.default,{type:"cross"+I}):"success"===E?p?S(m(s)):l.createElement(u.default,{type:"check"+I}):S(m(s)),T=l.createElement("span",{className:n+"-text"},R)}if("line"===w){var M={width:m(s)+"%",height:O||("small"===b?6:8)},N={width:m(v)+"%",height:O||("small"===b?6:8)},A=void 0!==v?l.createElement("div",{className:n+"-success-bg",style:N}):null;D=l.createElement("div",null,l.createElement("div",{className:n+"-outer"},l.createElement("div",{className:n+"-inner"},l.createElement("div",{className:n+"-bg",style:M}),A)),T)}else if("circle"===w||"dashboard"===w){var W=j||120,B={width:W,height:W,fontSize:.15*W+6},L=O||6,U=x||"dashboard"===w&&"bottom"||"top",F=P||"dashboard"===w&&75;D=l.createElement("div",{className:n+"-inner",style:B},l.createElement(f.Circle,{percent:m(s),strokeWidth:L,trailWidth:L,strokeColor:g[E],trailColor:h,prefixCls:n,gapDegree:F,gapPosition:U}),T)}var z=(0,d.default)(n,(t={},(0,r.default)(t,n+"-"+("dashboard"===w?"circle":w),!0),(0,r.default)(t,n+"-status-"+E,!0),(0,r.default)(t,n+"-show-info",_),(0,r.default)(t,n+"-"+b,b),t),i);return l.createElement("div",(0,o.default)({},k,{className:z}),D)}}]),e}(l.Component);e.default=b,b.defaultProps={type:"line",percent:0,showInfo:!0,trailColor:"#f3f3f3",prefixCls:"ant-progress",size:"default"},b.propTypes={status:p.default.oneOf(["normal","exception","active","success"]),type:p.default.oneOf(["line","circle","dashboard"]),showInfo:p.default.bool,percent:p.default.number,width:p.default.number,strokeWidth:p.default.number,trailColor:p.default.string,format:p.default.func,gapDegree:p.default.number,default:p.default.oneOf(["default","small"])},t.exports=e.default},481:function(t,e,n){},482:function(t,e,n){"use strict";n(55),n(481)},510:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var o,r=n(1),i=n(710),a=n.n(i),s=(n(465),o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),c=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},p={display:"inline",margin:"2%"},l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onClick=function(t){e.props.onClick&&e.props.onClick(t)},e}return s(e,t),e.prototype.render=function(){return r.createElement(a.a,c({},this.props),r.createElement("div",{onClick:this.onClick,style:p},this.props.value,this.props.children))},e}(r.Component)},513:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,r=n(479),i=(o=r)&&o.__esModule?o:{default:o};e.default=i.default,t.exports=e.default},538:function(t,e,n){"use strict";var o=n(1),r=n.n(o),i=n(139),a=n(5),s=n(71),c=n(3),p=n(30),l=function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},u=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},f=function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function a(t){try{c(o.next(t))}catch(t){i(t)}}function s(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(a,s)}c((o=o.apply(t,e||[])).next())})},d=function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},h=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}};function y(t){return!!t&&t.length>0}var g,m=function(){function t(t){var e=this;this.workerService=t,this.saving=!1,this.initialized=!1,this.currentNotations=[],this.workIndex=0,this.submit=function(t){return f(e,void 0,void 0,function(){var e;return d(this,function(n){switch(n.label){case 0:return(e=this.currentInstanceDetail).instance.submitDate=new Date,[4,this.workerService.submit(this.missionDetail.publicItem.missionId,e,t)];case 1:return[2,n.sent()]}})})}}return Object.defineProperty(t.prototype,"currentInstanceDetail",{get:function(){var t=this.initialDetail.instance;return{missionType:p.b.IMAGE,imageResults:this.currentNotations.map(function(e,n){return{id:n,instanceId:t.instanceId,imageJob:e.job,url:e.imageUrl,isDone:function(t){if(!t)return!1;switch(t.type){case i.a.DISTRICT:case i.a.PART:return y(t.tuples);case i.a.WHOLE:return!!t.tuple&&(y(t.tuple.tagTuples)||y(t.tuple.descriptions))}return!1}(e.job)}}),instance:t}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"types",{get:function(){return this.missionDetail.imageMissionTypes},enumerable:!0,configurable:!0}),t.prototype.initialize=function(t,e){this.missionDetail=t,this.initialDetail=e,this.imageUrls=t.imageUrls;var n,o,r=function(n){var o,r,a=function(t){var o=void 0;(o=e.imageResults?e.imageResults.find(function(e){return e.url===n&&e.imageJob&&e.imageJob.type===t}):null)?i.currentNotations.push({imageUrl:n,job:o.imageJob}):i.currentNotations.push({imageUrl:n,job:{type:t}})};try{for(var s=h(t.imageMissionTypes),c=s.next();!c.done;c=s.next()){a(c.value)}}catch(t){o={error:t}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}},i=this;try{for(var a=h(this.imageUrls),s=a.next();!s.done;s=a.next()){r(s.value)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}this.initialized=!0},Object.defineProperty(t.prototype,"finished",{get:function(){return this.workIndex===this.currentNotations.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalCount",{get:function(){return this.currentNotations.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"progress",{get:function(){return this.workIndex},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentWork",{get:function(){return this.workIndex==this.currentNotations.length?null:this.currentNotations[this.workIndex]},enumerable:!0,configurable:!0}),t.prototype.saveWork=function(t){this.currentNotations[this.workIndex]=t},t.prototype.nextWork=function(){this.workIndex++},t.prototype.previousWork=function(){this.workIndex>0&&this.workIndex--},t.prototype.saveProgress=function(t){return f(this,void 0,void 0,function(){var e=this;return d(this,function(n){switch(n.label){case 0:return this.saving=!0,console.log(Object(a.toJS)(this.currentInstanceDetail)),[4,this.workerService.saveProgress(this.missionDetail.publicItem.missionId,this.currentInstanceDetail,t)];case 1:return n.sent(),Object(a.runInAction)(function(){e.saving=!1}),[2]}})})},l([a.observable,u("design:type",Boolean)],t.prototype,"saving",void 0),l([a.observable,u("design:type",Number)],t.prototype,"workIndex",void 0),l([a.computed,u("design:type",Object),u("design:paramtypes",[])],t.prototype,"finished",null),l([a.computed,u("design:type",Object),u("design:paramtypes",[])],t.prototype,"progress",null),l([a.computed,u("design:type",Object),u("design:paramtypes",[])],t.prototype,"currentWork",null),l([a.action,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",void 0)],t.prototype,"saveWork",null),l([a.action,u("design:type",Function),u("design:paramtypes",[]),u("design:returntype",void 0)],t.prototype,"nextWork",null),l([a.action,u("design:type",Function),u("design:paramtypes",[]),u("design:returntype",void 0)],t.prototype,"previousWork",null),l([a.action,u("design:type",Function),u("design:paramtypes",[String]),u("design:returntype",Promise)],t.prototype,"saveProgress",null),t=l([c.Injectable,u("design:paramtypes",["function"==typeof(e=void 0!==s.a&&s.a)&&e||Object])],t);var e}(),b=n(14),v=n(831),w=n.n(v),O=(n(466),n(710)),j=n.n(O),_=(n(465),n(18)),C=n(474),P=(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}g(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),x="drawingPad.common.missionTipCard.",k=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return P(e,t),e.prototype.render=function(){return r.a.createElement(w.a,{title:r.a.createElement(_.b,{id:x+"title"})},r.a.createElement(C.a,{prompt:r.a.createElement(_.b,{id:x+"missionTitle"})},this.props.title),r.a.createElement(C.a,{prompt:r.a.createElement(_.b,{id:x+"type"})},r.a.createElement(_.b,{id:x+"types."+this.props.jobType})),r.a.createElement(C.a,{prompt:r.a.createElement(_.b,{id:x+"allowCustomTag.prompt"})},r.a.createElement(_.b,{id:x+"allowCustomTag."+this.props.allowCustomTag})),r.a.createElement(C.a,{prompt:r.a.createElement(_.b,{id:x+"tags"})},this.props.tags.map(function(t){return r.a.createElement(j.a,{key:t,color:"blue"},t)})))},e}(r.a.Component),E=n(141),T=n.n(E),D=(n(138),n(35)),S=n.n(D),R=(n(70),function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),I=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R(e,t),e.prototype.render=function(){var t="drawingPad.common.progressController.";return r.a.createElement(w.a,{style:{marginTop:"8px"}},r.a.createElement(T.a.Group,{size:"large"},r.a.createElement(T.a,{onClick:this.props.goPrevious},r.a.createElement(S.a,{type:"left"}),r.a.createElement(_.b,{id:t+"backward"})),this.props.readonlyMode?null:r.a.createElement(T.a,{type:"primary",onClick:this.props.saveProgress,loading:this.props.saving},r.a.createElement(S.a,{type:"save"}),r.a.createElement(_.b,{id:t+"save"})),r.a.createElement(T.a,{onClick:this.props.goNext},r.a.createElement(_.b,{id:t+"forward"}),r.a.createElement(S.a,{type:"right"}))))},e}(r.a.Component),M=n(713),N=n.n(M),A=(n(464),function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),W=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onInputChange=function(t,n){var o=e.props.items.slice();o[n]=t,e.props.onChange(o)},e.addADescription=function(){e.props.onChange(e.props.items.concat([""]))},e.removeOne=function(t){var n=e.props.items.slice();n.splice(t,1),e.props.onChange(n)},e}return A(e,t),e.prototype.render=function(){var t=this;return r.a.createElement(r.a.Fragment,null,this.props.items.map(function(e,n){return r.a.createElement(N.a,{placeholder:t.props.inputPrompt,value:e,key:n,onChange:function(e){return t.onInputChange(e.target.value,n)},addonAfter:t.props.readonly?null:r.a.createElement(S.a,{type:"minus-circle-o",onClick:function(){return t.removeOne(n)}})})}),this.props.readonly?null:r.a.createElement(T.a,{type:"dashed",onClick:this.addADescription},this.props.addingButtonPlaceholder||null))},e}(r.a.PureComponent),B=n(146),L=n.n(B),U=(n(316),n(540)),F=n(903),z=n.n(F),H=(n(487),n(476)),J=n(510),G=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),q=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},V=function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},X=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Y="drawingPad.common.tagDescriptionTuplePanel.",K=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tuple=q({},e.props.tagTuple),e.onOk=function(){e.tagNameValid&&e.props.onComplete(e.tuple)},e.onCancel=function(){e.props.onCancel()},e.onTagNameChange=function(t){e.tuple.tag=t.target.value},e.onDescriptionsChange=function(t){e.tuple.descriptions=t},e.onRemove=function(){e.props.onRemove(e.props.tagTuple)},e.onTagClick=function(t){e.tuple.tag=t},e}return G(e,t),Object.defineProperty(e.prototype,"tagNameValid",{get:function(){return!!this.tuple.tag},enumerable:!0,configurable:!0}),e.prototype.render=function(){var t=this,e=[r.a.createElement(T.a,{key:"back",onClick:this.onCancel},r.a.createElement(_.b,{id:Y+"cancel"}))];return this.props.readonly||e.push(r.a.createElement(T.a,{key:"remove",type:"danger",onClick:this.onRemove},r.a.createElement(_.b,{id:Y+"remove"})),r.a.createElement(T.a,{key:"submit",type:"primary",onClick:this.onOk},r.a.createElement(_.b,{id:Y+"ok"}))),r.a.createElement(z.a,{title:r.a.createElement(_.b,{id:Y+"tagInformation"}),visible:!0,onOk:this.onOk,onCancel:this.onCancel,footer:e},r.a.createElement("h3",null,r.a.createElement(_.b,{id:Y+"tagName"})),!this.props.readonly&&this.props.allowedTags&&r.a.createElement("div",null,r.a.createElement(_.b,{id:Y+"tagLimited"}),r.a.createElement("div",null,this.props.allowedTags.map(function(e){return r.a.createElement(J.a,{key:e,onClick:function(){return t.onTagClick(e)}},e)}))),r.a.createElement(_.c,{replacements:{placeholder:Y+"tagName",messageOnInvalid:Y+"tagNameInvalid"}},function(e){return r.a.createElement(H.a,{valid:t.tagNameValid,messageOnInvalid:e.messageOnInvalid},r.a.createElement(N.a,{placeholder:e.placeholder,value:t.tuple.tag,disabled:!!t.props.allowedTags,onChange:t.onTagNameChange}))}),r.a.createElement("h3",null,r.a.createElement(_.b,{id:Y+"descriptions"})),r.a.createElement(_.c,{replacements:{placeholder:Y+"addOne"}},function(e){return r.a.createElement(W,{items:t.tuple.descriptions,readonly:t.props.readonly,onChange:t.onDescriptionsChange,inputPrompt:e.placeholder,addingButtonPlaceholder:e.placeholder})}))},V([a.observable,X("design:type","function"==typeof(n=void 0!==U.TagTuple&&U.TagTuple)&&n||Object)],e.prototype,"tuple",void 0),V([a.computed,X("design:type",Object),X("design:paramtypes",[])],e.prototype,"tagNameValid",null),V([a.action,X("design:type",Object)],e.prototype,"onTagNameChange",void 0),V([a.action,X("design:type",Object)],e.prototype,"onDescriptionsChange",void 0),V([a.action,X("design:type",Object)],e.prototype,"onTagClick",void 0),e=V([b.observer],e);var n}(r.a.Component),Q=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Z=function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},$=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},tt=j.a,et=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selectedIndex=-1,e.onTagRemove=function(t){e.props.onChange(e.props.tagTuples.filter(function(e){return e!==t})),e.selectedIndex=-1},e.addNewTag=function(){e.props.onChange(e.props.tagTuples.concat([{tag:"",descriptions:[]}])),e.selectTag(e.props.tagTuples.length)},e.onTagChangeComplete=function(t){var n=e.props.tagTuples.slice();n[e.selectedIndex]=t,e.selectedIndex=-1,e.props.onChange(n)},e.onTagChangeCancelled=function(){e.selectedIndex=-1},e}return Q(e,t),Object.defineProperty(e.prototype,"selectedTagTuple",{get:function(){return this.selectedIndex>=0&&this.selectedIndex<this.props.tagTuples.length?this.props.tagTuples[this.selectedIndex]:null},enumerable:!0,configurable:!0}),e.prototype.selectTag=function(t){this.selectedIndex=t},e.prototype.render=function(){var t=this;return r.a.createElement(w.a,{style:rt,title:r.a.createElement(_.b,{id:"drawingPad.common.tagDescriptionTuplePanel.tags"})},this.props.tagTuples.map(function(e,n){var o=e.tag,i=o.length>20,a=r.a.createElement(tt,{key:n,onClick:function(){return t.selectTag(n)}},i?o.slice(0,20)+"...":o);return i?r.a.createElement(L.a,{title:o,key:n},a):a}),this.props.readonly?null:r.a.createElement(tt,{onClick:this.addNewTag,style:{background:"#fff",borderStyle:"dashed"}},r.a.createElement(S.a,{type:"plus"})," ",r.a.createElement(_.b,{id:"drawingPad.common.tagDescriptionTuplePanel.newTag"})),this.selectedTagTuple?r.a.createElement(K,{onRemove:this.onTagRemove,tagTuple:this.selectedTagTuple,onComplete:this.onTagChangeComplete,onCancel:this.onTagChangeCancelled,readonly:this.props.readonly,allowedTags:this.props.allowedTags}):null)},Z([a.observable,$("design:type",Number)],e.prototype,"selectedIndex",void 0),Z([a.computed,$("design:type",Object),$("design:paramtypes",[])],e.prototype,"selectedTagTuple",null),Z([a.action,$("design:type",Object)],e.prototype,"onTagRemove",void 0),Z([a.action,$("design:type",Function),$("design:paramtypes",[Number]),$("design:returntype",void 0)],e.prototype,"selectTag",null),Z([a.action,$("design:type",Object)],e.prototype,"onTagChangeComplete",void 0),Z([a.action,$("design:type",Object)],e.prototype,"onTagChangeCancelled",void 0),e=Z([b.observer],e)}(r.a.Component),nt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ot=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},rt={marginTop:"8px"},it=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onDescriptionsInputChange=function(t){e.props.onChange(ot({},e.props.tuple,{descriptions:t}))},e.onTagsChange=function(t){e.props.onChange(ot({},e.props.tuple,{tagTuples:t}))},e}return nt(e,t),e.prototype.render=function(){var t=this;return r.a.createElement("div",null,r.a.createElement(et,{tagTuples:this.props.tuple.tagTuples,onChange:this.onTagsChange,readonly:this.props.readonlyMode,allowedTags:this.props.allowedTags}),r.a.createElement(w.a,{style:rt,title:r.a.createElement(_.b,{id:"drawingPad.common.tagDescriptionTuplePanel.descriptions"})},r.a.createElement(_.c,{replacements:{prompt:"drawingPad.common.tagDescriptionTuplePanel.inputPrompt",addOne:"drawingPad.common.tagDescriptionTuplePanel.addOne"}},function(e){return r.a.createElement(W,{items:t.props.tuple.descriptions,onChange:t.onDescriptionsInputChange,inputPrompt:e.prompt,addingButtonPlaceholder:e.addOne,readonly:t.props.readonlyMode})})))},e}(r.a.Component),at=function(){function t(t){void 0===t&&(t={}),this.start={x:0,y:0},this.end={x:0,y:0},Object.assign(this,t)}return Object.defineProperty(t.prototype,"width",{get:function(){return Math.abs(this.end.x-this.start.x)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return Math.abs(this.end.y-this.start.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftTop",{get:function(){return{x:this.x,y:this.y}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightBottom",{get:function(){return{x:this.x+this.width,y:this.y+this.height}},enumerable:!0,configurable:!0}),t.prototype.isOnSides=function(t){var e=this.x,n=this.y,o=this.x+this.width,r=(this.y,this.x,this.y+this.height);this.x,this.width,this.y,this.height;return n<=t.y&&t.y<=r&&e<=t.x&&t.x<=o},t}(),st=function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},ct=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},pt=function(){function t(){}return st([a.observable,ct("design:type",String)],t.prototype,"tag",void 0),st([a.observable,ct("design:type",String)],t.prototype,"description",void 0),t}(),lt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ut=function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},ft=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},dt=function(t){function e(e){var n=t.call(this)||this;return n.rectangle=e,n}return lt(e,t),ut([a.observable,ft("design:type","function"==typeof(n=void 0!==at&&at)&&n||Object)],e.prototype,"rectangle",void 0),e;var n}(pt),ht=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),yt=function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},gt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},mt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onLoad=function(t){var n=t.target;e.width=n.width,e.height=n.height,e.props.onImageLoaded(n.width,n.height)},e}return ht(e,t),e.prototype.render=function(){var t={position:"relative",width:this.width,height:this.height};return r.a.createElement("div",{style:t},r.a.createElement("img",{src:this.props.imageUrl,onLoad:this.onLoad,style:{position:"absolute"}}),this.props.children)},yt([a.observable,gt("design:type",Number)],e.prototype,"width",void 0),yt([a.observable,gt("design:type",Number)],e.prototype,"height",void 0),yt([a.action,gt("design:type",Object)],e.prototype,"onLoad",void 0),e=yt([b.observer],e)}(r.a.Component),bt=function(){function t(t){this.context=t}return t.prototype.drawRectangle=function(t,e){this.context.save(),this.context.beginPath(),this.context.strokeStyle=e,this.context.rect(t.x,t.y,t.width,t.height),this.context.stroke(),this.context.restore()},t}();function vt(t,e,n){var o=t.getBoundingClientRect(),r=o.top,i=o.left;return{x:Math.trunc((e.clientX-i)/n),y:Math.trunc((e.clientY-r)/n)}}var wt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ot=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.findClickedRectangle=function(t){return e.props.rectangles.find(function(e){return e.rectangle.isOnSides(t)})},e.renderAllRectangles=function(){e.canvasContext.clearRect(0,0,e.props.width,e.props.height),e.props.rectangles.forEach(function(t){t===e.props.selectedRectangle?e.drawer.drawRectangle(t.rectangle,"#FF0000"):e.drawer.drawRectangle(t.rectangle,"#000000")})},e.onMouseDown=function(t){var n=vt(e.canvas,t,e.props.getScale()),o=e.findClickedRectangle(n);o&&e.props.onRectangleClicked(o)},e.ref=function(t){e.canvas=t,t&&(e.canvasContext=e.canvas.getContext("2d"),e.drawer=new bt(e.canvasContext))},e}return wt(e,t),e.prototype.componentDidUpdate=function(){this.renderAllRectangles()},e.prototype.componentDidMount=function(){this.renderAllRectangles()},e.prototype.render=function(){return r.a.createElement("canvas",{style:{position:"absolute"},ref:this.ref,width:this.props.width,height:this.props.height,onMouseDown:this.onMouseDown})},e}(r.a.Component),jt=function(){function t(t){this.context=t}return t.prototype.saveImageData=function(){this.imageData=this.context.getImageData(0,0,this.context.canvas.clientWidth,this.context.canvas.clientHeight)},t.prototype.putImageData=function(){this.context.putImageData(this.imageData,0,0)},t}(),_t=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ct=1,Pt=function(t){function e(e){var n=t.call(this,e)||this;return n.rectangle=new at({id:Ct}),Ct++,n}return _t(e,t),Object.defineProperty(e.prototype,"start",{set:function(t){this.rectangle.start=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"end",{set:function(t){this.rectangle.end=t},enumerable:!0,configurable:!0}),e}(jt),xt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onMouseDown=function(t){var n=vt(e.canvas,t,e.props.getScale());e.session=new Pt(e.canvasContext),e.session.saveImageData(),e.session.start=n},e.onMouseMove=function(t){if(e.session){var n=vt(e.canvas,t,e.props.getScale());e.outOfCanvas(n)?(e.props.onRectangleComplete(null),e.finalize()):(e.session.putImageData(),e.session.end=n,e.drawer.drawRectangle(e.session.rectangle,"#000000"))}},e.onMouseUp=function(t){e.session&&(e.onMouseMove(t),e.props.onRectangleComplete(e.session.rectangle),e.finalize())},e.ref=function(t){e.canvas=t,t&&(e.canvasContext=e.canvas.getContext("2d"),e.drawer=new bt(e.canvasContext))},e}return _t(e,t),e.prototype.outOfCanvas=function(t){return t.x>this.props.width||t.y>this.props.height},e.prototype.finalize=function(){this.session.putImageData(),this.session=null},e.prototype.render=function(){return r.a.createElement("canvas",{style:{position:"absolute"},ref:this.ref,width:this.props.width,height:this.props.height,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseUp:this.onMouseUp})},e}(r.a.Component),kt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Et=function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},Tt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Dt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onBackgroundImageLoaded=function(t,n){e.width=t,e.height=n,e.props.onImageLoaded(t,n)},e}return kt(e,t),e.prototype.render=function(){return r.a.createElement(mt,{imageUrl:this.props.imageUrl,onImageLoaded:this.onBackgroundImageLoaded},r.a.createElement(Ot,{rectangles:this.props.rectangles,width:this.width,height:this.height,onRectangleClicked:this.props.onRectangleClicked,selectedRectangle:this.props.selectedRectangle,getScale:this.props.getScale}),this.props.drawingMode?r.a.createElement(xt,{onRectangleComplete:this.props.onRectangleComplete,width:this.width,height:this.height,getScale:this.props.getScale}):null)},Et([a.observable,Tt("design:type",Number)],e.prototype,"width",void 0),Et([a.observable,Tt("design:type",Number)],e.prototype,"height",void 0),Et([a.action,Tt("design:type",Object)],e.prototype,"onBackgroundImageLoaded",void 0),e=Et([b.observer],e)}(r.a.Component);function St(t,e){return t.x==e.x&&t.y==e.y}var Rt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();function It(t,e){return St(t.leftTopPoint,e.rectangle.leftTop)||St(t.rightBottomPoint,e.rectangle.rightBottom)}var Mt,Nt,At,Wt,Bt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onDrawComplete=function(t){t?e.props.onDrawComplete({leftTopPoint:t.leftTop,rightBottomPoint:t.rightBottom,tagDescriptionTuple:{tagTuples:[],descriptions:[]}}):e.props.onDrawComplete(null)},e.onRecClicked=function(t){var n=e.props.tuples.find(function(e){return It(e,t)});n&&e.props.onTupleSelected(n)},e}return Rt(e,t),e.prototype.render=function(){var t=this,e=this.props.tuples.map(function(t){return new dt(new at({start:t.leftTopPoint,end:t.rightBottomPoint}))}),n=this.props.selectedTuple?e.find(function(e){return It(t.props.selectedTuple,e)}):null;return r.a.createElement("div",null,r.a.createElement(Dt,{drawingMode:this.props.addingMode,onRectangleComplete:this.onDrawComplete,onRectangleClicked:this.onRecClicked,rectangles:e,selectedRectangle:n,imageUrl:this.props.imageUrl,onImageLoaded:this.props.onImageLoaded,getScale:this.props.getScale}))},e}(r.a.Component),Lt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Lt(e,t),e.prototype.render=function(){var t="drawingPad.rectangle.";return r.a.createElement(w.a,null,r.a.createElement(T.a,{onClick:this.props.start,disabled:this.props.addingMode},r.a.createElement(_.b,{id:t+"add"})),r.a.createElement(T.a,{onClick:this.props.removeSelected},r.a.createElement(_.b,{id:t+"removeSelected"})))},e}(r.a.Component),Ft=n(22),zt=function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t},Ht=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Jt=Ft.a.div.withConfig({displayName:"Container"})(Mt||(Mt=zt(["\n    display: flex;\n    flex-wrap: wrap;\n"],["\n    display: flex;\n    flex-wrap: wrap;\n"]))),Gt=Ft.a.div.withConfig({displayName:"Controller"})(Nt||(Nt=zt(["\n    flex: 1 0 auto;\n    min-width: 100px;\n"],["\n    flex: 1 0 auto;\n    min-width: 100px;\n"]))),qt=Ft.a.div.withConfig({displayName:"PictureContainer"})(At||(At=zt(["\n    overflow: hidden;\n    margin-right: 8px;\n    margin-bottom: 8px;\n    width: ",";\n    height: ",";\n"],["\n    overflow: hidden;\n    margin-right: 8px;\n    margin-bottom: 8px;\n    width: ",";\n    height: ",";\n"])),function(t){return t.width},function(t){return t.height}),Vt=Ft.a.div.withConfig({displayName:"Picture"})(Wt||(Wt=zt(["\n  transform-origin: top left;\n  transform: scale(1);\n  width: ",";\n  height: ",";\n"],["\n  transform-origin: top left;\n  transform: scale(1);\n  width: ",";\n  height: ",";\n"])),function(t){return t.width},function(t){return t.height}),Xt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pictureContainerRef=r.a.createRef(),e.pictureRef=r.a.createRef(),e.scale=1,e.onResize=function(){e.adjustPictureSize()},e.adjustPictureSize=function(){var t=e.pictureContainerRef.current.clientWidth/e.props.imageWidth;t!=e.scale&&(e.scale=t,e.appendScale(),e.props.setScale(t))},e}return Ht(e,t),e.prototype.appendScale=function(){this.scale,this.props.imageWidth;var t=this.scale*this.props.imageHeight;this.pictureRef.current.style.transform="scale("+Math.min(this.scale,1)+")",this.pictureContainerRef.current.style.height=t+"px"},e.prototype.componentDidUpdate=function(){this.adjustPictureSize()},e.prototype.componentDidMount=function(){window.onresize=this.onResize},e.prototype.componentWillUnmount=function(){window.onresize=null},e.prototype.render=function(){return r.a.createElement(Jt,null,r.a.createElement(qt,{innerRef:this.pictureContainerRef,width:this.props.imageWidth,height:this.props.imageHeight},r.a.createElement(Vt,{innerRef:this.pictureRef,width:this.props.imageWidth,height:this.props.imageHeight},this.props.children[0])),r.a.createElement(Gt,null,this.props.children[1]))},e}(r.a.Component),Yt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Kt=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t};function Qt(t){return t.job&&t.job.tuples||(t.job={type:i.a.PART,tuples:[]}),t}var Zt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scale=1,e.state={notation:Qt(e.props.notation),selectedIndex:-1,addingMode:!1,width:1,height:1},e.submit=function(){console.log(Object(a.toJS)(e.state.notation)),e.props.submit(e.state.notation)},e.onTupleCreated=function(t){e.state.notation.job.tuples=e.state.notation.job.tuples.concat([t]),e.setState({selectedIndex:e.state.notation.job.tuples.length-1,addingMode:!1})},e.onTupleChanged=function(t){e.selectedTuple.tagDescriptionTuple=t,e.forceUpdate()},e.startAdding=function(){e.setState({selectedIndex:-1,addingMode:!0})},e.onTupleSelected=function(t){e.setState({selectedIndex:e.state.notation.job.tuples.indexOf(t)})},e.removeSelected=function(){e.state.selectedIndex>=0&&e.selectedTuple&&e.setState({notation:Kt({},e.state.notation,{job:Kt({},e.state.notation.job,{tuples:e.state.notation.job.tuples.filter(function(t){return t!==e.selectedTuple})})})})},e.getScale=function(){return e.scale},e.goNext=function(){e.props.goNext(e.state.notation)},e.onImageLoaded=function(t,n){e.setState({width:t,height:n})},e.setScale=function(t){e.scale=t},e}return Yt(e,t),e.getDerivedStateFromProps=function(t,e){return t.notation!==e.notation?{notation:Qt(t.notation),selectedIndex:-1,addingMode:!1}:null},Object.defineProperty(e.prototype,"selectedTuple",{get:function(){return this.state.selectedIndex>=0&&this.state.selectedIndex<this.state.notation.job.tuples.length?this.state.notation.job.tuples[this.state.selectedIndex]:null},enumerable:!0,configurable:!0}),e.prototype.render=function(){var t=this.props.notation,e=t.imageUrl,n=t.job,o=this.props,i=o.missionDetail,a=(o.controllerProps,o.readonlyMode),s=this.selectedTuple;return r.a.createElement(Xt,{imageUrl:e,imageHeight:this.state.height,imageWidth:this.state.width,setScale:this.setScale},r.a.createElement(r.a.Fragment,null,r.a.createElement(Bt,{imageUrl:e,tuples:this.state.notation.job.tuples,onDrawComplete:this.onTupleCreated,addingMode:this.state.addingMode,onTupleSelected:this.onTupleSelected,selectedTuple:s,onImageLoaded:this.onImageLoaded,getScale:this.getScale})),r.a.createElement(r.a.Fragment,null,r.a.createElement(k,{jobType:n.type,tags:i.publicItem.allowedTags,allowCustomTag:i.publicItem.allowCustomTag,title:i.publicItem.title}),a?null:r.a.createElement(Ut,{start:this.startAdding,addingMode:this.state.addingMode,removeSelected:this.removeSelected}),s?r.a.createElement(it,{tuple:s.tagDescriptionTuple,readonlyMode:a,onChange:this.onTupleChanged,allowedTags:i.publicItem.allowCustomTag?null:i.publicItem.allowedTags}):null,r.a.createElement(I,Kt({},this.props.controllerProps,{goNext:this.goNext,readonlyMode:this.props.readonlyMode,saveProgress:this.submit}))))},e}(r.a.Component);function $t(t,e){var n=t.end,o=t.start,r=e.end,i=e.start,a=o.y-n.y,s=n.x-o.x,c=i.y-r.y,p=r.x-i.x;if(0==a*p-s*c)return!1;var l=c*r.x+p*r.y;if((c*n.x+p*n.y-l)*(c*o.x+p*o.y-l)>=0)return!1;var u=a*n.x+s*n.y;return(a*r.x+s*r.y-u)*(a*i.x+s*i.y-u)<0}var te,ee=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ne=function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},oe=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},re=function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},ie=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}},ae=function(){function t(){this.points=[],this.lines=function(){var t;return re(this,function(e){switch(e.label){case 0:t=1,e.label=1;case 1:return t<this.points.length?[4,{start:this.points[t-1],end:this.points[t]}]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})}}return t.prototype.push=function(t){this.points.push(t)},t.prototype.cross=function(t){try{for(var e=ie(this.lines()),n=e.next();!n.done;n=e.next()){if($t(n.value,t))return!0}}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=e.return)&&r.call(e)}finally{if(o)throw o.error}}return!1;var o,r},t.prototype.isInside=function(t){var e,n,o={start:t,end:{x:0,y:t.y}},r=!1;try{for(var i=ie(this.lines()),a=i.next();!a.done;a=i.next()){$t(a.value,o)&&(r=!r)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},t.prototype.contains=function(t){return this.points.indexOf(t)>=0},t}(),se=1,ce=function(){function t(t){void 0===t&&(t=[]),this.id=se,se++,this.boundaries=t}return Object.defineProperty(t.prototype,"added",{get:function(){return this.boundaries.length>0},enumerable:!0,configurable:!0}),t.prototype.addBoundary=function(t){this.boundaries.push(t)},t.prototype.isInside=function(t){return null!=this.boundaries.find(function(e){return e.isInside(t)})},t}(),pe=function(t){function e(e){var n=t.call(this)||this;return n.district=e,n}return ee(e,t),ne([a.observable,oe("design:type",ce)],e.prototype,"district",void 0),e}(pt),le=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}},ue=function(){function t(t){var e=this;this.strokeBoundary=function(t,n){e.context.save(),e.context.strokeStyle=n,e.context.beginPath();var o,r,i=t.points[0],a=i.x,s=i.y;e.context.moveTo(a,s);try{for(var c=le(t.lines()),p=c.next();!p.done;p=c.next()){var l=p.value;e.context.lineTo(l.start.x,l.start.y)}}catch(t){o={error:t}}finally{try{p&&!p.done&&(r=c.return)&&r.call(c)}finally{if(o)throw o.error}}e.context.closePath(),e.context.stroke(),e.context.restore()},this.fillBoundary=function(t,n){e.fillPolygon(t.points,n)},this.context=t,this.width=t.canvas.clientWidth,this.height=t.canvas.clientHeight}return t.prototype.fillDistrict=function(t,e){var n=this;t.boundaries.forEach(function(t){n.fillBoundary(t,e)})},t.prototype.strokeDistrict=function(t,e){var n=this;t.boundaries.forEach(function(t){n.strokeBoundary(t,e)})},t.prototype.fillPolygon=function(t,e){this.context.save(),this.context.beginPath();var n,o,r=t[0],i=r.x,a=r.y;this.context.moveTo(i,a);try{for(var s=le(t),c=s.next();!c.done;c=s.next()){var p=c.value;this.context.lineTo(p.x,p.y)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}this.context.closePath(),this.context.fillStyle=e,this.context.fill(),this.context.restore()},t.prototype.strokeLine=function(t,e,n){this.context.save(),this.context.lineJoin="round",this.context.lineCap="round",this.context.beginPath(),this.context.globalCompositeOperation="source-over",this.context.strokeStyle=n,this.context.moveTo(t.x,t.y),this.context.lineTo(e.x,e.y),this.context.stroke(),this.context.restore()},t}(),fe=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),de=function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},he=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ref=function(t){e.canvas=t,t&&(e.canvasContext=e.canvas.getContext("2d"),e.drawer=new ue(e.canvasContext))},e.renderAllDistricts=function(){e.canvasContext.clearRect(0,0,e.props.width,e.props.height),e.props.districts.forEach(function(t){t===e.props.selectedDistrict?e.drawer.fillDistrict(t.district,"rgba(255,0,0,0.4)"):e.drawer.strokeDistrict(t.district,"rgba(255,0,0,1)")})},e.onMouseDown=function(t){var n=vt(e.canvas,t,e.props.getScale()),o=e.props.districts.find(function(t){return t.district.isInside(n)});console.log(o),o&&e.props.onDistrictSelected(o)},e}return fe(e,t),e.prototype.componentDidMount=function(){this.renderAllDistricts()},e.prototype.componentDidUpdate=function(){this.renderAllDistricts()},e.prototype.render=function(){return r.a.createElement("canvas",{ref:this.ref,style:{position:"absolute"},width:this.props.width,height:this.props.height,onMouseDown:this.onMouseDown})},e=de([b.observer],e)}(r.a.Component),ye=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ge=function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},me=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.ReadyToDraw=0]="ReadyToDraw",t[t.DrawingBoundary=1]="DrawingBoundary",t[t.BoundaryDrawn=2]="BoundaryDrawn",t[t.Complete=3]="Complete"}(te||(te={}));var be=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.step=te.ReadyToDraw,e.district=new ce,e.boundary=null,e.error="",e}return ye(e,t),e.prototype.init=function(t){this.context=t,this.width=t.canvas.clientWidth,this.height=t.canvas.clientHeight},Object.defineProperty(e.prototype,"canContinueDrawing",{get:function(){return this.step in[te.ReadyToDraw,te.BoundaryDrawn]},enumerable:!0,configurable:!0}),e.prototype.clearError=function(){this.error=""},e.prototype.boundaryComplete=function(t,e){t?this.district.addBoundary(this.boundary):this.error=e,this.district.added?this.step=te.BoundaryDrawn:this.step=te.ReadyToDraw},e.prototype.startDrawingBoundary=function(t){this.boundary=null,this.step=te.DrawingBoundary,this.startPoint=t,this.boundary=new ae,this.boundary.push(t)},e.prototype.continueDrawing=function(){this.step=te.ReadyToDraw},ge([a.observable,me("design:type",Object)],e.prototype,"step",void 0),ge([a.observable,me("design:type",String)],e.prototype,"error",void 0),ge([a.computed,me("design:type",Object),me("design:paramtypes",[])],e.prototype,"canContinueDrawing",null),ge([a.action,me("design:type",Function),me("design:paramtypes",[]),me("design:returntype",void 0)],e.prototype,"clearError",null),ge([a.action,me("design:type",Function),me("design:paramtypes",[Boolean,String]),me("design:returntype",void 0)],e.prototype,"boundaryComplete",null),ge([a.action,me("design:type",Function),me("design:paramtypes",[(!1,Object)]),me("design:returntype",void 0)],e.prototype,"startDrawingBoundary",null),ge([a.action,me("design:type",Function),me("design:paramtypes",[]),me("design:returntype",void 0)],e.prototype,"continueDrawing",null),e}(jt),ve=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),we=function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},Oe=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.colorStartPoint=function(t){e.canvasContext.fillRect(t.x-1,t.y-1,3,3)},e.checkCross=function(t){return e.props.session.boundary.cross(t)},e.boundaryComplete=function(t,n){e.props.session.putImageData(),e.props.session.boundaryComplete(t,n),e.refillAllBoundaries()},e.endsAtStartPoint=function(t){return Math.abs(t.x-e.props.session.startPoint.x)<=2&&Math.abs(t.y-e.props.session.startPoint.y)<=2},e.onMouseDown=function(t){var n=vt(e.canvas,t,e.props.getScale());e.props.session.canContinueDrawing&&(e.colorStartPoint(n),e.props.session.startDrawingBoundary(n))},e.onMouseMove=function(t){if(e.props.session.step===te.DrawingBoundary){var n=vt(e.canvas,t,e.props.getScale());e.outOfCanvas(n)&&e.boundaryComplete(!1,"outOfBound"),e.props.session.clearError();var o=e.props.session.boundary.points.slice(-1)[0];e.checkCross({start:o,end:n})?e.boundaryComplete(!1,"cross"):(e.drawer.strokeLine(o,n,"#000000"),e.props.session.boundary.push(n))}},e.onMouseUp=function(t){var n=vt(e.canvas,t,e.props.getScale());e.props.session.step===te.DrawingBoundary&&(e.endsAtStartPoint(n)?(e.props.session.boundary.push(e.props.session.startPoint),e.boundaryComplete(!0)):e.boundaryComplete(!1,"notEndsAtStartingPoint"))},e.ref=function(t){e.canvas=t,t&&(e.canvasContext=e.canvas.getContext("2d"),e.drawer=new ue(e.canvasContext),e.props.session.init(e.canvasContext),e.props.session.saveImageData(),e.forceUpdate())},e}return ve(e,t),e.prototype.refillAllBoundaries=function(){var t=this;this.canvasContext.clearRect(0,0,this.props.width,this.props.height),this.props.session.district.boundaries.forEach(function(e){return t.drawer.fillBoundary(e,"rgba(255,0,0,0.4)")})},e.prototype.outOfCanvas=function(t){return t.x>this.props.width||t.y>this.props.height},e.prototype.render=function(){return r.a.createElement("canvas",{style:{position:"absolute"},ref:this.ref,width:this.props.width,height:this.props.height,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseUp:this.onMouseUp})},e=we([b.observer],e)}(r.a.Component),je=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),_e=function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},Ce=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Pe=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onBackgroundImageLoaded=function(t,n){e.height=n,e.width=t,e.props.onImageLoad(t,n)},e}return je(e,t),e.prototype.render=function(){return r.a.createElement("div",null,r.a.createElement(mt,{imageUrl:this.props.imgUrl,onImageLoaded:this.onBackgroundImageLoaded},r.a.createElement(he,{selectedDistrict:this.props.selectedNotation,districts:this.props.districts,onDistrictSelected:this.props.onDistrictClicked,width:this.width,height:this.height,getScale:this.props.getScale}),this.props.drawingMode?r.a.createElement(Oe,{session:this.props.session,width:this.width,height:this.height,getScale:this.props.getScale}):null))},_e([a.observable,Ce("design:type",Number)],e.prototype,"width",void 0),_e([a.observable,Ce("design:type",Number)],e.prototype,"height",void 0),_e([a.action,Ce("design:type",Object)],e.prototype,"onBackgroundImageLoaded",void 0),e=_e([b.observer],e)}(r.a.Component),xe=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();function ke(t){var e=new ae;return e.points=t.points,e}function Ee(t,e){if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(t[n].points!==e[n].points)return!1;return!0}var Te=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onDistrictClicked=function(t){var n=e.props.tuples.find(function(e){return Ee(e.boundaries,t.district.boundaries)});n&&e.props.onTupleSelected(n)},e}return xe(e,t),e.prototype.render=function(){var t=this,e=this.props.tuples.map(function(t){return new pe(new ce(t.boundaries.map(ke)))}),n=this.props.selectedTuple?e.find(function(e){return Ee(t.props.selectedTuple.boundaries,e.district.boundaries)}):null;return r.a.createElement("div",null,r.a.createElement(Pe,{selectedNotation:n,drawingMode:this.props.addingMode,onDistrictClicked:this.onDistrictClicked,districts:e,imgUrl:this.props.imageUrl,session:this.props.session,onImageLoad:this.props.onImageLoad,getScale:this.props.getScale}))},e}(r.a.Component),De=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Se=function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},Re=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return De(e,t),e.prototype.render=function(){var t,e=this,n=this.props,o=n.addingMode,i=n.session,a="drawingPad.district.";if(!o)return r.a.createElement(w.a,null,r.a.createElement(T.a,{onClick:this.props.start,disabled:o},r.a.createElement(_.b,{id:a+"add"})),r.a.createElement(T.a,{onClick:this.props.onRemoveSelected},r.a.createElement(_.b,{id:a+"removeSelected"})));switch(i.step){case te.ReadyToDraw:t=r.a.createElement("p",null,r.a.createElement(_.b,{id:a+"prompts.readyToDraw"}));break;case te.DrawingBoundary:t=r.a.createElement("p",null,r.a.createElement(_.b,{id:a+"prompts.drawingBoundary"}));break;case te.BoundaryDrawn:t=r.a.createElement("div",null,r.a.createElement(_.b,{id:a+"prompts.boundaryDown",replacements:{continueDrawing:r.a.createElement(T.a,{onClick:function(){return i.continueDrawing()}},r.a.createElement(_.b,{id:a+"prompts.continueDrawing"})),confirm:r.a.createElement(T.a,{onClick:function(){return e.props.onDistrictComplete(i.district)}},r.a.createElement(_.b,{id:a+"prompts.confirm"}))}}))}return r.a.createElement(w.a,null,t,i.error?r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement("p",null,r.a.createElement("strong",null,r.a.createElement(_.b,{id:a+"prompts.error.errorTip"}))),r.a.createElement("p",null,r.a.createElement(_.b,{id:a+"prompts.error."+i.error}))):null)},e=Se([b.observer],e)}(r.a.Component),Ie=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Me=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t};function Ne(t){return t.job&&t.job.tuples||(t.job={type:i.a.DISTRICT,tuples:[]}),t}var Ae=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scale=1,e.state={notation:Ne(e.props.notation),selectedIndex:-1,addingMode:!1,width:1,height:1},e.submit=function(){console.log(Object(a.toJS)(e.state.notation)),e.props.submit(e.state.notation)},e.onTupleCreated=function(t){e.state.notation.job.tuples=e.state.notation.job.tuples.concat([t]),e.setState({selectedIndex:e.state.notation.job.tuples.length-1,addingMode:!1})},e.onTupleChanged=function(t){e.selectedTuple.tagDescriptionTuple=t,e.forceUpdate()},e.startAdding=function(){e.setState({selectedIndex:-1,addingMode:!0})},e.onDistrictComplete=function(t){e.onTupleCreated({boundaries:t.boundaries,tagDescriptionTuple:{tagTuples:[],descriptions:[]}})},e.onTupleSelected=function(t){e.setState({selectedIndex:e.state.notation.job.tuples.indexOf(t)})},e.removeSelected=function(){e.selectedTuple&&e.setState({notation:Me({},e.state.notation,{job:Me({},e.state.notation.job,{tuples:e.state.notation.job.tuples.filter(function(t){return t!==e.selectedTuple})})})})},e.goNext=function(){e.props.goNext(e.state.notation)},e.onImageLoaded=function(t,n){e.setState({width:t,height:n})},e.setScale=function(t){e.scale=t},e.getScale=function(){return e.scale},e}return Ie(e,t),e.getDerivedStateFromProps=function(t,e){return t.notation!==e.notation?{notation:Ne(t.notation),selectedIndex:-1,addingMode:!1}:null},Object.defineProperty(e.prototype,"selectedTuple",{get:function(){return this.state.selectedIndex>=0&&this.state.selectedIndex<this.state.notation.job.tuples.length?this.state.notation.job.tuples[this.state.selectedIndex]:null},enumerable:!0,configurable:!0}),e.prototype.render=function(){var t,e=this.props.notation,n=e.imageUrl,o=e.job,i=this.props,a=i.missionDetail,s=i.readonlyMode,c=this.selectedTuple;return this.state.addingMode&&(t=new be),r.a.createElement(Xt,{imageUrl:n,imageWidth:this.state.width,imageHeight:this.state.height,setScale:this.setScale},r.a.createElement(r.a.Fragment,null,r.a.createElement(Te,{imageUrl:n,tuples:this.state.notation.job.tuples,addingMode:this.state.addingMode,session:t,onTupleSelected:this.onTupleSelected,selectedTuple:c,onImageLoad:this.onImageLoaded,getScale:this.getScale})),r.a.createElement(r.a.Fragment,null,r.a.createElement(k,{jobType:o.type,tags:a.publicItem.allowedTags,allowCustomTag:a.publicItem.allowCustomTag,title:a.publicItem.title}),s?null:r.a.createElement(Re,{session:t,start:this.startAdding,addingMode:this.state.addingMode,onDistrictComplete:this.onDistrictComplete,onRemoveSelected:this.removeSelected}),c?r.a.createElement(it,{tuple:c.tagDescriptionTuple,readonlyMode:s,onChange:this.onTupleChanged,allowedTags:a.publicItem.allowCustomTag?null:a.publicItem.allowedTags}):null,r.a.createElement(I,Me({},this.props.controllerProps,{goNext:this.goNext,readonlyMode:s,saveProgress:this.submit}))))},e}(r.a.Component),We=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Be=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t};function Le(t){return t.job&&t.job.tuple||(t.job={type:i.a.WHOLE,tuple:{tagTuples:[],descriptions:[]}}),t}var Ue=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scale=1,e.state={notation:Le(e.props.notation),selectedIndex:-1,addingMode:!1,width:1,height:1},e.goNext=function(){e.props.goNext(e.state.notation)},e.onTupleChange=function(t){e.state.notation.job.tuple=t,e.forceUpdate()},e.submit=function(){console.log(Object(a.toJS)(e.state.notation)),e.props.submit(e.state.notation)},e.setScale=function(t){e.scale=t},e.onImageLoad=function(t){e.setState({width:t.target.width,height:t.target.height})},e}return We(e,t),e.getDerivedStateFromProps=function(t,e){return t.notation!==e.notation?{notation:Le(t.notation)}:null},e.prototype.render=function(){var t=this.state.notation,e=t.imageUrl,n=t.job,o=this.props,i=o.missionDetail;o.controllerProps;return r.a.createElement(Xt,{imageUrl:e,imageWidth:this.state.width,imageHeight:this.state.height,setScale:this.setScale},r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{onLoad:this.onImageLoad,src:e})),r.a.createElement(r.a.Fragment,null,r.a.createElement(k,{jobType:n.type,tags:i.publicItem.allowedTags,allowCustomTag:i.publicItem.allowCustomTag,title:i.publicItem.title}),r.a.createElement(it,{tuple:n.tuple,onChange:this.onTupleChange,readonlyMode:this.props.readonlyMode,allowedTags:i.publicItem.allowCustomTag?null:i.publicItem.allowedTags}),r.a.createElement(I,Be({},this.props.controllerProps,{goNext:this.goNext,readonlyMode:this.props.readonlyMode,saveProgress:this.submit}))))},e}(r.a.Component),Fe=n(832),ze=n.n(Fe),He=(n(502),n(513)),Je=n.n(He),Ge=(n(482),function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),qe=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onSaveProgress=function(){e.props.saveProgress()},e.onCancel=function(){e.props.goBack()},e.onSubmit=function(){e.props.submit()},e}return Ge(e,t),e.prototype.render=function(){var t="drawingPad.common.finish.";return r.a.createElement(z.a,{visible:this.props.shown,title:r.a.createElement(_.b,{id:t+"editingCompleteTitle"}),footer:[r.a.createElement(T.a,{key:"goBack",onClick:this.onCancel},r.a.createElement(_.b,{id:t+"goBack"})),r.a.createElement(T.a,{key:"saveProgress",onClick:this.onSaveProgress},r.a.createElement(_.b,{id:t+"saveProgress"})),r.a.createElement(T.a,{key:"submit",type:"primary",onClick:this.onSubmit},r.a.createElement(_.b,{id:t+"submit"}))]},r.a.createElement("p",null,r.a.createElement(_.b,{id:t+"editingComplete"})))},e}(r.a.Component),Ve=n(20),Xe=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ye=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Ke=function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},Qe=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ze=function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function a(t){try{c(o.next(t))}catch(t){i(t)}}function s(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(a,s)}c((o=o.apply(t,e||[])).next())})},$e=function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},tn="drawingPad.common.",en=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.finishModalShown=!0,e.saveWork=function(t){return Ze(e,void 0,void 0,function(){return $e(this,function(e){switch(e.label){case 0:return this.store.saveWork(t),[4,this.store.saveProgress(this.props.token)];case 1:return e.sent(),ze.a.success(this.localeStore.get(tn+"finish.workSaved")),[2]}})})},e.goNext=function(t){e.store.saveWork(t),e.store.nextWork()},e.goPrevious=function(){e.store.previousWork()},e.submit=function(){return Ze(e,void 0,void 0,function(){return $e(this,function(t){switch(t.label){case 0:return[4,this.store.submit(this.props.token)];case 1:return t.sent()?(console.log("success"),this.props.jumpBack()):console.log("failure"),[2]}})})},e.cancelFinishModal=function(){e.store.workIndex--,e.finishModalShown=!1},e.saveProgress=function(){return Ze(e,void 0,void 0,function(){return $e(this,function(t){switch(t.label){case 0:return[4,this.store.saveProgress(this.props.token)];case 1:return t.sent(),this.props.jumpBack(),[2]}})})},e}return Xe(e,t),e.prototype.componentDidMount=function(){var t=this.props,e=t.instanceDetail,n=t.missionDetail;this.store.initialize(n,e),this.forceUpdate()},e.prototype.componentDidUpdate=function(){if(this.store.finished){if(this.props.readonlyMode)return ze.a.info(this.localeStore.get(tn+"finish.readonlyComplete")),void this.store.workIndex--;this.finishModalShown=!0}},e.prototype.chooseWorkPage=function(){var t=this.store.currentWork;if(this.store.finished)return this.props.readonlyMode?r.a.createElement("div",null):r.a.createElement(qe,{shown:this.finishModalShown,submit:this.submit,saveProgress:this.saveProgress,goBack:this.cancelFinishModal});var e={notation:t,submit:this.saveWork,missionDetail:this.props.missionDetail,goNext:this.goNext,controllerProps:{goPrevious:this.goPrevious,previousAvailable:0!=this.store.workIndex,saving:this.store.saving},readonlyMode:this.props.readonlyMode};switch(t.job.type){case i.a.PART:return r.a.createElement(Zt,Ye({},e));case i.a.DISTRICT:return r.a.createElement(Ae,Ye({},e));case i.a.WHOLE:return r.a.createElement(Ue,Ye({},e))}},e.prototype.render=function(){var t=this,e=this.props;e.instanceDetail,e.missionDetail;return r.a.createElement("div",{style:{overflow:"hidden"}},this.store.initialized?this.chooseWorkPage():null,r.a.createElement("div",null,r.a.createElement(Je.a,{percent:this.store.progress/this.store.totalCount*100,status:"active",format:function(e){return t.store.progress+"/"+t.store.totalCount}})))},Ke([c.Inject,Qe("design:type","function"==typeof(n=void 0!==m&&m)&&n||Object)],e.prototype,"store",void 0),Ke([c.Inject,Qe("design:type","function"==typeof(o=void 0!==Ve.a&&Ve.a)&&o||Object)],e.prototype,"localeStore",void 0),Ke([a.observable,Qe("design:type",Object)],e.prototype,"finishModalShown",void 0),Ke([a.action,Qe("design:type",Object)],e.prototype,"saveWork",void 0),Ke([a.action,Qe("design:type",Function),Qe("design:paramtypes",[]),Qe("design:returntype",void 0)],e.prototype,"componentDidUpdate",null),Ke([a.action,Qe("design:type",Object)],e.prototype,"cancelFinishModal",void 0),e=Ke([Object(c.Module)({providers:[{provide:m,useClass:m,noSingleton:!0}]}),b.observer],e);var n,o}(r.a.Component),nn=n(43),on=n(48);n.d(e,"a",function(){return cn});var rn=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),an=function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},sn=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},cn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return rn(e,t),e.prototype.render=function(){var t=this,e=this.props,n=e.instanceDetail,o=e.missionDetail;return o.publicItem.missionType===p.b.IMAGE?r.a.createElement(en,{instanceDetail:n,missionDetail:o,token:this.props.token,jumpBack:function(){return t.routerStore.jumpTo("/mission")},readonlyMode:this.props.readonly}):null},an([c.Inject,sn("design:type","function"==typeof(n=void 0!==nn.a&&nn.a)&&n||Object)],e.prototype,"routerStore",void 0),an([c.Inject,sn("design:type","function"==typeof(o=void 0!==s.a&&s.a)&&o||Object)],e.prototype,"workerService",void 0),an([c.Inject,sn("design:type","function"==typeof(i=void 0!==on.a&&on.a)&&i||Object)],e.prototype,"missionService",void 0),e=an([b.observer],e);var n,o,i}(r.a.Component)},540:function(t,e){},821:function(t,e,n){"use strict";n.r(e),n.d(e,"RequesterSeeResultEntry",function(){return b});var o,r=n(1),i=n.n(r),a=n(3),s=n(48),c=n(28),p=n(538),l=n(83),u=n(471),f=n(72),d=(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),h=function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},y=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},g=function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function a(t){try{c(o.next(t))}catch(t){i(t)}}function s(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(a,s)}c((o=o.apply(t,e||[])).next())})},m=function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},b=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.renderContent=function(){return g(e,void 0,void 0,function(){var t,e,n;return m(this,function(o){switch(o.label){case 0:return t=this.userStore.token,[4,this.requesterService.getInstanceDetail(this.props.instanceId,t)];case 1:return e=o.sent().detail,[4,this.missionService.getAMission(e.instance.missionId,t)];case 2:return n=o.sent(),[2,i.a.createElement(p.a,{instanceDetail:e,missionDetail:n,token:t,readonly:!0})]}})})},e}return d(e,t),e.prototype.render=function(){return i.a.createElement(l.a,{render:this.renderContent,componentWhenLoading:i.a.createElement(u.a,null)})},h([a.Inject,y("design:type","function"==typeof(n=void 0!==f.a&&f.a)&&n||Object)],e.prototype,"requesterService",void 0),h([a.Inject,y("design:type","function"==typeof(o=void 0!==s.a&&s.a)&&o||Object)],e.prototype,"missionService",void 0),h([a.Inject,y("design:type","function"==typeof(r=void 0!==c.a&&c.a)&&r||Object)],e.prototype,"userStore",void 0),e;var n,o,r}(i.a.Component)}}]);